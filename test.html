<style>
   .ticket-selector-category {
      margin: 5px;
   }
   .well {
      background-color: #FFFFFF;
      border-left: 5px solid #242b4c;
      padding: 15px 0px 50px 0px;
   }
   .row {  
      margin: 0px;
   }
   .well:hover {
      background-color: #f0f0f2;
   }
   #left-column {
      border-style: solid;
      border-width: 1px;
      border-color: #c8c9d2;
      padding-bottom: 10px;
   }
</style>

<div class="row" id="ticket-selector">
   <div id="left-column" class="col-xs-12 col-sm-4" >
      <h2>Ticket Selector</h2>   
      <div id="ticket-selector-ages">
      <h3>Select an age range</h3>
   </div>
   <div id="ticket-selector-categories">
      <h3>Select categories that apply to you</h3>
   </div>
   </div>
   <div id="right-column" class="col-xs-12 col-sm-8"">
      <h3>Results</h3>   
      <div id="ticket-selector-results"></div>
      <a role="button" class="btn btn-default" onclick="evalProducts(products.length)">View all options</a>
   </div>
</div>

<script>
var selected = []; //the categories selected
const products =
[
 {
  "name": "free travel",
  "url": "TBC",
  "image": "\/sites\/default\/files\/styles\/original\/public\/acquiadam-assets\/adult-go-card.png?itok=K4OQdmht",
  "0-4 years": 5,
  "5-14 years": -5,
  "15 years older": -5,
  "primary school student": -5,
  "high school student": -5,
  "tertiary student": -5,
  "senior": -5,
  "job seeker": -5,
  "asylum seeker": -5,
  "disability": -5,
  "disability carer": -5,
  "pension": -5,
  "DVA card holder": -5,
  "tourist": 0,
  "frequent traveller": 0,
  "infrequent traveller": 0,
  "non-seq": 0
 },
 {
  "name": "go card child",
  "url": "https:\/\/translink.com.au\/tickets-and-fares\/concessions\/children",
  "image": "\/sites\/default\/files\/styles\/original\/public\/acquiadam-assets\/adult-go-card.png?itok=K4OQdmht",
  "0-4 years": -5,
  "5-14 years": 5,
  "15 years older": -5,
  "primary school student": 5,
  "high school student": 3,
  "tertiary student": -5,
  "senior": 0,
  "job seeker": -5,
  "asylum seeker": 0,
  "disability": 0,
  "disability carer": -5,
  "pension": 0,
  "DVA card holder": -5,
  "tourist": 0,
  "frequent traveller": 0,
  "infrequent traveller": 0,
  "non-seq": -5
 },
 {
  "name": "go card concession",
  "url": "https:\/\/translink.com.au\/tickets-and-fares\/concessions",
  "image": "\/sites\/default\/files\/styles\/original\/public\/acquiadam-assets\/adult-go-card.png?itok=K4OQdmht",
  "0-4 years": -5,
  "5-14 years": 0,
  "15 years older": 3,
  "primary school student": 0,
  "high school student": 3,
  "tertiary student": -5,
  "senior": 0,
  "job seeker": 0,
  "asylum seeker": 0,
  "disability": 0,
  "disability carer": 0,
  "pension": 5,
  "DVA card holder": 0,
  "tourist": 0,
  "frequent traveller": 0,
  "infrequent traveller": 0,
  "non-seq": -5
 },
 {
  "name": "go card senior & senior plus",
  "url": "https:\/\/translink.com.au\/tickets-and-fares\/concessions\/seniors",
  "image": "\/sites\/default\/files\/styles\/original\/public\/acquiadam-assets\/adult-go-card.png?itok=K4OQdmht",
  "0-4 years": -5,
  "5-14 years": -5,
  "15 years older": 0,
  "primary school student": -5,
  "high school student": -5,
  "tertiary student": 0,
  "senior": 5,
  "job seeker": 0,
  "asylum seeker": 0,
  "disability": 0,
  "disability carer": 0,
  "pension": 1,
  "DVA card holder": 1,
  "tourist": 0,
  "frequent traveller": 0,
  "infrequent traveller": 0,
  "non-seq": -5
 },
 {
  "name": "go card stas",
  "url": "https:\/\/translink.com.au\/tickets-and-fares\/concessions\/school-students\/school-transport-assistance",
  "image": "\/sites\/default\/files\/styles\/original\/public\/acquiadam-assets\/adult-go-card.png?itok=K4OQdmht",
  "0-4 years": -5,
  "5-14 years": 3,
  "15 years older": 1,
  "primary school student": 3,
  "high school student": 3,
  "tertiary student": -5,
  "senior": -5,
  "job seeker": -5,
  "asylum seeker": 0,
  "disability": 0,
  "disability carer": 0,
  "pension": -5,
  "DVA card holder": 0,
  "tourist": 0,
  "frequent traveller": 0,
  "infrequent traveller": 0,
  "non-seq": -5
 },
 {
  "name": "go card adult",
  "url": "https:\/\/translink.com.au\/tickets-and-fares\/go-card\/about-go-card",
  "image": "\/sites\/default\/files\/styles\/original\/public\/acquiadam-assets\/adult-go-card.png?itok=K4OQdmht",
  "0-4 years": -5,
  "5-14 years": 0,
  "15 years older": 3,
  "primary school student": -5,
  "high school student": -5,
  "tertiary student": 5,
  "senior": 1,
  "job seeker": 5,
  "asylum seeker": 5,
  "disability": 1,
  "disability carer": 1,
  "pension": 1,
  "DVA card holder": 1,
  "tourist": 3,
  "frequent traveller": 5,
  "infrequent traveller": 3,
  "non-seq": -5
 },
 {
  "name": "go explore child",
  "url": "https:\/\/translink.com.au\/tickets-and-fares\/ticket-types\/visitors-and-tourists\/go-explore",
  "image": "\/sites\/default\/files\/styles\/original\/public\/acquiadam-assets\/adult-go-card.png?itok=K4OQdmht",
  "0-4 years": -5,
  "5-14 years": 2,
  "15 years older": 1,
  "primary school student": 0,
  "high school student": 0,
  "tertiary student": -5,
  "senior": 0,
  "job seeker": -5,
  "asylum seeker": 0,
  "disability": 0,
  "disability carer": 0,
  "pension": -5,
  "DVA card holder": -5,
  "tourist": 5,
  "frequent traveller": 0,
  "infrequent traveller": 0,
  "non-seq": -5
 },
 {
  "name": "go explore adult",
  "url": "https:\/\/translink.com.au\/tickets-and-fares\/ticket-types\/visitors-and-tourists\/go-explore",
  "image": "\/sites\/default\/files\/styles\/original\/public\/acquiadam-assets\/adult-go-card.png?itok=K4OQdmht",
  "0-4 years": -5,
  "5-14 years": -5,
  "15 years older": 2,
  "primary school student": -5,
  "high school student": -5,
  "tertiary student": 0,
  "senior": 0,
  "job seeker": 0,
  "asylum seeker": 0,
  "disability": 0,
  "disability carer": 0,
  "pension": 0,
  "DVA card holder": 0,
  "tourist": 5,
  "frequent traveller": 0,
  "infrequent traveller": 0,
  "non-seq": -5
 },
 {
  "name": "go seeq child",
  "url": "https:\/\/translink.com.au\/tickets-and-fares\/ticket-types\/visitors-and-tourists\/go-seeq",
  "image": "\/sites\/default\/files\/styles\/original\/public\/acquiadam-assets\/adult-go-card.png?itok=K4OQdmht",
  "0-4 years": -5,
  "5-14 years": 2,
  "15 years older": 1,
  "primary school student": 0,
  "high school student": 0,
  "tertiary student": -5,
  "senior": 0,
  "job seeker": -5,
  "asylum seeker": 0,
  "disability": 0,
  "disability carer": 0,
  "pension": -5,
  "DVA card holder": -5,
  "tourist": 5,
  "frequent traveller": 0,
  "infrequent traveller": 0,
  "non-seq": -5
 },
 {
  "name": "go seeq adult",
  "url": "https:\/\/translink.com.au\/tickets-and-fares\/ticket-types\/visitors-and-tourists\/go-seeq",
  "image": "\/sites\/default\/files\/styles\/original\/public\/acquiadam-assets\/adult-go-card.png?itok=K4OQdmht",
  "0-4 years": -5,
  "5-14 years": -5,
  "15 years older": 2,
  "primary school student": 0,
  "high school student": 0,
  "tertiary student": 0,
  "senior": 0,
  "job seeker": 0,
  "asylum seeker": 0,
  "disability": 0,
  "disability carer": 0,
  "pension": 0,
  "DVA card holder": 0,
  "tourist": 5,
  "frequent traveller": 0,
  "infrequent traveller": 0,
  "non-seq": -5
 },
 {
  "name": "access pass",
  "url": "https:\/\/translink.com.au\/tickets-and-fares\/ticket-types\/disability\/translink-access-pass",
  "image": "\/sites\/default\/files\/styles\/original\/public\/acquiadam-assets\/adult-go-card.png?itok=K4OQdmht",
  "0-4 years": -5,
  "5-14 years": 0,
  "15 years older": 0,
  "primary school student": 0,
  "high school student": 0,
  "tertiary student": 0,
  "senior": 0,
  "job seeker": 0,
  "asylum seeker": 0,
  "disability": 5,
  "disability carer": 5,
  "pension": 0,
  "DVA card holder": 0,
  "tourist": 0,
  "frequent traveller": 0,
  "infrequent traveller": 0,
  "non-seq": 0
 },
 {
  "name": "TPI\/EDA",
  "url": "https:\/\/translink.com.au\/tickets-and-fares\/concessions\/pensioners-and-veterans",
  "image": "\/sites\/default\/files\/styles\/original\/public\/acquiadam-assets\/adult-go-card.png?itok=K4OQdmht",
  "0-4 years": -5,
  "5-14 years": -5,
  "15 years older": 0,
  "primary school student": -5,
  "high school student": -5,
  "tertiary student": 0,
  "senior": 0,
  "job seeker": 0,
  "asylum seeker": 0,
  "disability": 5,
  "disability carer": 0,
  "pension": 0,
  "DVA card holder": 5,
  "tourist": 0,
  "frequent traveller": 0,
  "infrequent traveller": 0,
  "non-seq": 0
 },
 {
  "name": "paper ticket",
  "url": "https:\/\/translink.com.au\/tickets-and-fares\/buy-and-refund-tickets",
  "image": "\/sites\/default\/files\/styles\/original\/public\/acquiadam-assets\/adult-go-card.png?itok=K4OQdmht",
  "0-4 years": -5,
  "5-14 years": 1,
  "15 years older": 1,
  "primary school student": 1,
  "high school student": 1,
  "tertiary student": 1,
  "senior": 1,
  "job seeker": 1,
  "asylum seeker": 1,
  "disability": 1,
  "disability carer": 1,
  "pension": 1,
  "DVA card holder": 1,
  "tourist": 3,
  "frequent traveller": 0,
  "infrequent traveller": 3,
  "non-seq": 5
 }
]
const categories = Object.keys(products[0]); //use the keys of the first object as categories
categories.splice(0, 3); //remove name and link field as categories
var results = [];

function select(category) { //adds selected item to array
   if (!selected.includes(category)) { //if not already selected
      selected.push(category); //add to selected list
   } else selected = selected.filter(function(e) { return e !== category }) //else remove category from array
   document.getElementById(category).classList.toggle("active");
   evalProducts(3); //update results
}

function evalProducts(amount) { //evaluates all products against the selected categories and produces a list
   document.getElementById('ticket-selector-results').innerHTML = ""; //wipe results on page
   for (var i = 0; i < products.length; i++) { //for every product
      products[i].value = 0; //wipe the value of each product
      for (var j = 0; j < selected.length; j++) { //for every selected category
         products[i].value += products[i][selected[j]]; //increment product's value
      }
   }
   if (selected.length == 0) { //if nothing is selected
      products.find(obj => obj.name = "go card adult").value = 5; //prioritise go card
   }
   results = products.slice(0); //create separate array to filter results
   results.sort(function(a,b) { //sort results by value
      return b.value - a.value;
   });
   if (amount < products.length) { //if not looking at all products, filter out null or negative results
      results = results.filter(d => d.value > 0); //filter null or negative results
   }
   for (i = 0; i < amount; i++) { //create cards for the specified amount of products
      if (results[i] != null) { //if the requested result exists
         document.getElementById('ticket-selector-results').innerHTML += '<div class="well" id="result' + i + '"></div>';
         document.querySelector("#result" + i).insertAdjacentHTML("beforeend", '<h4><a href="' + results[i].url + '">' + results[i].name + '</h4>'); //title and url
         document.querySelector("#result" + i).insertAdjacentHTML("beforeend", '<p>Debug value: ' + results[i].value + '</p>'); //debug value
         document.querySelector("#result" + i).insertAdjacentHTML("afterbegin", '<div class="img-responsive original col-xs-6 col-md-3"><a href="' + results[i].url + '"><img class="product-image" src="' + results[i].image + '" typeof="foaf:Image" role="presentation" aria-hidden="true"></a></div>'); //test go card image  
      }
   }
}

function generateButtons() {
   for (var i = 0; i < categories.length; i++) { //generate categories
      if (categories[i].includes("years")) { //if an age category
         document.getElementById('ticket-selector-ages').insertAdjacentHTML("afterend", '<a role="button" id="' + categories[i] + '" class="btn btn-default ticket-selector-category" id="category" onclick="select(\'' + categories[i] + '\')"> ' + categories[i] + '</a>');
      } else {  
         document.getElementById('ticket-selector-categories').insertAdjacentHTML ("afterend", '<a role="button" id="' + categories[i] + '" class="btn btn-default ticket-selector-category" id="category" onclick="select(\'' + categories[i] + '\')"> ' + categories[i] + '</a>');
      }
   }
}

generateButtons();
evalProducts(1); //initial run
</script>
